<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_275) on Sat Jun 18 21:03:29 JST 2022 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>TokenRequestHandlerSpi (com.authlete:authlete-java-jaxrs 2.45 API)</title>
<meta name="date" content="2022-06-18">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="TokenRequestHandlerSpi (com.authlete:authlete-java-jaxrs 2.45 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6,"i1":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TokenRequestHandlerSpi.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/authlete/jaxrs/spi/DeviceVerificationRequestHandlerSpiAdapter.html" title="class in com.authlete.jaxrs.spi"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/authlete/jaxrs/spi/TokenRequestHandlerSpiAdapter.html" title="class in com.authlete.jaxrs.spi"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/authlete/jaxrs/spi/TokenRequestHandlerSpi.html" target="_top">Frames</a></li>
<li><a href="TokenRequestHandlerSpi.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.authlete.jaxrs.spi</div>
<h2 title="Interface TokenRequestHandlerSpi" class="title">Interface TokenRequestHandlerSpi</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><a href="../../../../com/authlete/jaxrs/spi/TokenRequestHandlerSpiAdapter.html" title="class in com.authlete.jaxrs.spi">TokenRequestHandlerSpiAdapter</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">TokenRequestHandlerSpi</span></pre>
<div class="block">Service Provider Interface to work with <a href="../../../../com/authlete/jaxrs/TokenRequestHandler.html" title="class in com.authlete.jaxrs"><code>TokenRequestHandler</code></a>.

 <p>
 An implementation of this interface must be given to the constructor
 of <a href="../../../../com/authlete/jaxrs/TokenRequestHandler.html" title="class in com.authlete.jaxrs"><code>TokenRequestHandler</code></a>
 class.
 </p></div>
<dl>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>Takahiko Kawasaki</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/authlete/jaxrs/spi/TokenRequestHandlerSpi.html#authenticateUser-java.lang.String-java.lang.String-">authenticateUser</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;username,
                <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;password)</code>
<div class="block">Authenticate an end-user.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>com.authlete.common.dto.Property[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/authlete/jaxrs/spi/TokenRequestHandlerSpi.html#getProperties--">getProperties</a></span>()</code>
<div class="block">Get extra properties to associate with an access token.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="authenticateUser-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>authenticateUser</h4>
<pre><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;authenticateUser(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;username,
                        <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;password)</pre>
<div class="block">Authenticate an end-user.

 <p>
 This method is called only when <a href=
 "https://tools.ietf.org/html/rfc6749#section-4.3">Resource Owner
 Password Credentials Grant</a> was used. Therefore, if you have
 no mind to support Resource Owner Password Credentials, always
 return <code>null</code>. In typical cases, you don't have to support
 Resource Owner Password Credentials Grant.
 FYI: RFC 6749 says <i>"The authorization server should take special
 care when enabling this grant type and only allow it when other
 flows are not viable."</i>
 </p>

 <p>
 Below is an example implementation using <a href=
 "http://shiro.apache.org/">Apache Shiro</a>.
 </p>

 <blockquote>
 <pre style="border: 1px solid gray; padding: 0.5em; margin: 1em;">
 <span style="color: gray;">&#x40;Override</span>
 <span style="color: purple; font-weight: bold;">public</span> String authenticateUser(String username, String password)
 {
     <span style="color: green;">// Pack the username and password into AuthenticationToken
     // which Apache Shiro's SecurityManager can accept.</span>
     <a href="https://shiro.apache.org/static/1.2.3/apidocs/org/apache/shiro/authc/AuthenticationToken.html"
     style="text-decoration: none;">AuthenticationToken</a> credentials =
         <span style="color: purple; font-weight: bold;">new</span> <a href=
         "https://shiro.apache.org/static/1.2.3/apidocs/org/apache/shiro/authc/UsernamePasswordToken.html#UsernamePasswordToken(java.lang.String,%20java.lang.String)"
         style="text-decoration: none;">UsernamePasswordToken</a>(username, password);

     <span style="color: purple; font-weight: bold;">try</span>
     {
         <span style="color: green;">// Authenticate the resource owner.</span>
         <a href="https://shiro.apache.org/static/1.2.3/apidocs/org/apache/shiro/authz/AuthorizationInfo.html"
         style="text-decoration: none;">AuthenticationInfo</a> info =
             <a href="https://shiro.apache.org/static/1.2.3/apidocs/org/apache/shiro/SecurityUtils.html"
             style="text-decoration: none;">SecurityUtils</a>.<a href=
             "https://shiro.apache.org/static/1.2.3/apidocs/org/apache/shiro/SecurityUtils.html#getSecurityManager()"
             style="text-decoration: none;">getSecurityManager()</a>.<a href=
             "https://shiro.apache.org/static/1.2.3/apidocs/org/apache/shiro/authc/Authenticator.html#authenticate(org.apache.shiro.authc.AuthenticationToken)"
             style="text-decoration: none;">authenticate</a>(credentials);

         <span style="color: green;">// Get the subject of the authenticated user.</span>
         <span style="color: purple; font-weight: bold;">return</span> info.<a href=
         "https://shiro.apache.org/static/1.2.3/apidocs/org/apache/shiro/authc/AuthenticationInfo.html#getPrincipals()"
         style="text-decoration: none;">getPrincipals()</a>.<a href=
         "https://shiro.apache.org/static/1.2.3/apidocs/org/apache/shiro/subject/PrincipalCollection.html#getPrimaryPrincipal()"
         style="text-decoration: none;">getPrimaryPrincipal()</a>.toString();
     }
     <span style="color: purple; font-weight: bold;">catch</span> (<a href=
     "https://shiro.apache.org/static/1.2.3/apidocs/org/apache/shiro/authz/AuthorizationException.html"
     style="text-decoration: none;">AuthenticationException</a> e)
     {
         <span style="color: green;">// Not authenticated.</span>
         <span style="color: purple; font-weight: bold;">return</span> null;
     }
 }</pre>
 </blockquote></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>username</code> - The value of <code>username</code> parameter in the token request.</dd>
<dd><code>password</code> - The value of <code>password</code> parameter in the token request.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The subject (= unique identifier) of the authenticated
         end-user. If the pair of <code>username</code> and <code>password</code> is invalid, <code>null</code> should be returned.</dd>
</dl>
</li>
</ul>
<a name="getProperties--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getProperties</h4>
<pre>com.authlete.common.dto.Property[]&nbsp;getProperties()</pre>
<div class="block">Get extra properties to associate with an access token.

 <p>
 This method is expected to return an array of extra properties.
 The following is an example that returns an array containing one
 extra property.
 </p>

 <pre style="border: 1px solid gray; padding: 0.5em; margin: 1em;">
 <span style="color: gray;">&#x40;Override</span>
 <span style="color: purple; font-weight: bold;">public</span> <code>Property</code>[] getProperties()
 {
     <span style="color: purple; font-weight: bold;">return</span> <span style="color: purple; font-weight: bold;">new</span> <code>Property</code>[] {
         <span style="color: purple; font-weight: bold;">new</span> <code>Property</code>(<span style="color: darkred;">"example_parameter"</span>, <span style="color: darkred;">"example_value"</span>)
     };
 }</pre>
 </blockquote>

 <p>
 Extra properties returned from this method will appear as top-level entries
 in a JSON response from an authorization server as shown in <a href=
 "https://tools.ietf.org/html/rfc6749#section-5.1">5.1. Successful Response</a>
 in RFC 6749.
 </p>

 <p>
 Keys listed below should not be used and they would be ignored on
 the server side even if they were used. It's because they are reserved
 in <a href="https://tools.ietf.org/html/rfc6749">RFC 6749</a> and
 <a href="http://openid.net/specs/openid-connect-core-1_0.html"
 >OpenID Connect Core 1.0</a>.
 </p>

 <ul>
   <li><code>access_token</code>
   <li><code>token_type</code>
   <li><code>expires_in</code>
   <li><code>refresh_token</code>
   <li><code>scope</code>
   <li><code>error</code>
   <li><code>error_description</code>
   <li><code>error_uri</code>
   <li><code>id_token</code>
 </ul>

 <p>
 Note that <b>there is an upper limit on the total size of extra properties</b>.
 On the server side, the properties will be (1) converted to a multidimensional
 string array, (2) converted to JSON, (3) encrypted by AES/CBC/PKCS5Padding, (4)
 encoded by base64url, and then stored into the database. The length of the
 resultant string must not exceed 65,535 in bytes. This is the upper limit, but
 we think it is big enough.
 </p>

 <p>
 When the value of <code>grant_type</code> parameter contained in the token request
 from the client application is <code>authorization_code</code> or <code>refresh_token</code>,
 extra properties are merged. Rules are as described in the table below.
 </p>

 <blockquote>
 <table border="1" cellpadding="5" style="border-collapse: collapse;">
   <thead>
     <tr>
       <th><code>grant_type</code></th>
       <th>Description</th>
     </tr>
   </thead>
   <tbody>
     <tr>
       <td><code>authorization_code</code></td>
       <td>
         <p>
           If the authorization code presented by the client application already
           has extra properties (this happens if <a href="../../../../com/authlete/jaxrs/spi/AuthorizationDecisionHandlerSpi.html#getProperties--"><code>AuthorizationDecisionHandlerSpi.getProperties()</code></a> returned extra properties
           when the authorization code was issued), extra properties returned by this
           method will be merged into the existing extra properties. Note that the
           existing extra properties will be overwritten if extra properties returned
           by this method have the same keys.
         </p>
         <p>
           For example, if an authorization code has two extra properties, <code>a=1</code>
           and <code>b=2</code>, and if this method returns two extra properties, <code>a=A</code>
           and <code>c=3</code>, the resultant access token will have three extra properties,
           <code>a=A</code>, <code>b=2</code> and <code>c=3</code>.
         </p>
       </td>
     </tr>
     <tr>
       <td><code>refresh_token</code></td>
       <td>
         <p>
           If the access token associated with the refresh token presented by the
           client application already has extra properties, extra properties returned
           by this method will be merged into the existing extra properties. Note that
           the existing extra properties will be overwritten if extra properties
           returned by this method have the same keys.
         </p>
       </td>
   </tbody>
 </table>
 </blockquote></div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Extra properties. If <code>null</code> is returned, any extra
         property will not be associated.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.3</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TokenRequestHandlerSpi.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/authlete/jaxrs/spi/DeviceVerificationRequestHandlerSpiAdapter.html" title="class in com.authlete.jaxrs.spi"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/authlete/jaxrs/spi/TokenRequestHandlerSpiAdapter.html" title="class in com.authlete.jaxrs.spi"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/authlete/jaxrs/spi/TokenRequestHandlerSpi.html" target="_top">Frames</a></li>
<li><a href="TokenRequestHandlerSpi.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2022. All rights reserved.</small></p>
</body>
</html>
